<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Attendance and Exam Management System</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    color: #fff;
    background-color: #0d1b2a;
  }

  /* Background before login (bubbles) */
  body.login-bg {
    background-color: #0d1b2a;
  }

  /* âœ… Aerial Campus Background after login */
  body.dashboard-bg {
    background: url('https://educationnews.co.ke/wp-content/uploads/2025/06/tug1qUMWHFOHhISH7TAAOGLHsJZR6WGYcgBXH8sF.jpg') 
      no-repeat center center fixed;
    background-size: cover;
    overflow: auto;
  }

  /* Dashboard header */
  #dashboard-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px 20px;
    background-color: rgba(0,0,0,0.6);
    border-bottom: 2px solid #00ffff;
    box-shadow: 0 0 10px #00ffff;
  }

  #dashboard-title {
    color: white;
    font-weight: bold;
    font-size: 24px;
    text-align: center;
  }

  img#logo {
    width: 120px;
    height: auto;
  }

  /* Buttons */
  .btn {
    padding: 8px 15px;
    background-color: #004d99;
    color: white;
    border: 2px solid #00ffff;
    border-radius: 5px;
    cursor: pointer;
    margin: 5px 0;
    box-shadow: 0 0 10px #00ffff;
    transition: 0.3s;
  }
  .btn:hover {
    background-color: #003366;
    box-shadow: 0 0 20px #00ffff;
  }

  /* Input fields */
  input[type="text"], input[type="number"], select {
    padding: 5px;
    margin: 5px 0;
    border: 2px solid #00ffff;
    border-radius: 5px;
    outline: none;
  }
  input[type="text"]:focus, input[type="number"]:focus, select:focus {
    border-color: #00ffff;
    box-shadow: 0 0 10px #00ffff;
  }

  /* Forms and sections */
  #login-section, #signup-section {
    padding: 20px;
    max-width: 400px;
    margin: 50px auto;
    background-color: rgba(0,0,0,0.7);
    border-radius: 10px;
    box-shadow: 0 0 15px #00ffff;
  }

  #dashboard-section, #users-section, #attendance-section, #exam-section {
    padding: 20px;
    max-width: 1000px;
    margin: 20px auto;
    background-color: rgba(0,0,0,0.6);
    border-radius: 10px;
    box-shadow: 0 0 15px #00ffff;
  }

  /* Tables */
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
    background-color: rgba(0,0,0,0.8);
  }
  th, td {
    border: 2px solid #00ffff;
    padding: 8px;
    text-align: left;
  }
  th {
    background-color: #004d99;
    cursor: pointer;
  }

  /* Admin side menu */
  #admin-menu {
    display: flex;
    flex-direction: column;
    width: 200px;
    float: left;
    margin-right: 20px;
  }
  #admin-menu button {
    margin-bottom: 10px;
    width: 100%;
  }

  /* Content area */
  #admin-content {
    margin-left: 220px;
  }

  h2, h3 {
    color: #00ffff;
  }

  /* Particle canvas before login */
  canvas#particle-canvas {
    position: fixed;
    top:0; left:0;
    width:100%;
    height:100%;
    z-index:-1;
  }

</style>
</head>

<body class="login-bg">

<!-- Particle Canvas (before login) -->
<canvas id="particle-canvas"></canvas>

<!-- Dashboard Header -->
<div id="dashboard-header">
  <img id="logo" src="https://matilitechnical.ac.ke/images/logo.png" alt="Matili TTI Logo">
  <h1 id="dashboard-title">ATTENDANCE AND EXAM MANAGEMENT SYSTEM</h1>
</div>

<!-- Login Section -->
<div id="login-section">
  <h2>Login</h2>
  <input type="text" id="login-username" placeholder="Username"><br>
  <input type="text" id="login-email" placeholder="Email"><br>
  <button class="btn" onclick="login()">Login</button>
  <p>Don't have an account? <button class="btn" onclick="showSignup()">Sign Up</button></p>
</div>

<!-- Signup Section -->
<div id="signup-section" style="display:none;">
  <h2>Sign Up</h2>
  <input type="text" id="signup-username" placeholder="Username"><br>
  <input type="text" id="signup-email" placeholder="Email"><br>
  <select id="signup-role">
    <option value="Student">Student</option>
    <option value="Teacher">Teacher</option>
    <option value="Admin">Admin</option>
  </select><br>
  <input type="text" id="signup-department" placeholder="Department"><br>
  <button class="btn" onclick="signup()">Sign Up</button>
</div>

<!-- Dashboard Section -->
<div id="dashboard-section" style="display:none;">
  <button class="btn" onclick="logout()">Logout</button>

  <!-- Admin Side Menu -->
  <div id="admin-menu" style="display:none;">
    <button class="btn" onclick="showAdminContent('students')">Students</button>
    <button class="btn" onclick="showAdminContent('teachers')">Teachers</button>
    <button class="btn" onclick="showAdminContent('units')">Units</button>
    <button class="btn" onclick="showAdminContent('results')">Results</button>
  </div>

  <!-- Admin Content Area -->
  <div id="admin-content"></div>

  <!-- Teacher Attendance Section -->
  <div id="attendance-section" style="display:none;">
    <h3>Mark Attendance</h3>
    <div id="attendance-form-container"></div>
    <table id="attendance-table">
      <thead><tr><th>Date</th><th>Unit</th><th>Student</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
    <button class="btn" onclick="markAttendance()">Mark Attendance</button>
  </div>

  <!-- Teacher Exam Section -->
  <div id="exam-section" style="display:none;">
    <h3>Exam Marks</h3>
    <div id="exam-form-container"></div>
    <table id="exam-table">
      <thead><tr><th>Exam</th><th>Unit</th><th>Student</th><th>Marks</th><th>Total</th></tr></thead>
      <tbody></tbody>
    </table>
    <button class="btn" onclick="recordExam()">Save Exams</button>
  </div>
</div>

<script>
// --- Users and Data ---
let users=[], units=[], attendanceRecords=[], examRecords=[], currentUser=null;

// Signup
function showSignup(){
  document.getElementById('login-section').style.display='none';
  document.getElementById('signup-section').style.display='block';
}
function signup(){
  let u=document.getElementById('signup-username').value;
  let e=document.getElementById('signup-email').value;
  let r=document.getElementById('signup-role').value;
  let d=document.getElementById('signup-department').value;
  if(!u || !e){ alert("Username and Email required!"); return; }
  users.push({username:u,email:e,role:r,department:d});
  alert('Signup success! Please login.');
  document.getElementById('signup-username').value='';
  document.getElementById('signup-email').value='';
  document.getElementById('signup-section').style.display='none';
  document.getElementById('login-section').style.display='block';
}

// Login
function login(){
  let u=document.getElementById('login-username').value;
  let e=document.getElementById('login-email').value;
  currentUser=users.find(x=>x.username===u && x.email===e);
  if(currentUser){
    document.body.className='dashboard-bg';
    document.getElementById('login-section').style.display='none';
    document.getElementById('signup-section').style.display='none';
    document.getElementById('dashboard-section').style.display='block';
    if(currentUser.role==="Admin"){ document.getElementById('admin-menu').style.display='flex'; showAdminContent('students');}
    else if(currentUser.role==="Teacher"){ showAttendanceForm(); showExamForm();}
    else if(currentUser.role==="Student"){ renderAttendanceTable(); renderExamTable();}
    alert(`Welcome, ${currentUser.username}!`);
  } else { alert('User not found!'); }
}

// Logout
function logout(){
  currentUser=null;
  document.body.className='login-bg';
  document.getElementById('login-section').style.display='block';
  document.getElementById('dashboard-section').style.display='none';
}

// Admin Panel
function showAdminContent(section){
  const content=document.getElementById('admin-content');
  content.style.display='block';
  let html='';
  if(section==='students'){
    html=`<h3>Students</h3>
    <input type="text" id="add-student-name" placeholder="Student Name">
    <input type="text" id="add-student-dept" placeholder="Department">
    <button class="btn" onclick="addStudent()">Add Student</button>
    <table id="students-table"><thead><tr><th>Name</th><th>Department</th></tr></thead><tbody></tbody></table>`;
  } else if(section==='teachers'){
    html=`<h3>Teachers</h3>
    <input type="text" id="add-teacher-name" placeholder="Teacher Name">
    <input type="text" id="add-teacher-dept" placeholder="Department">
    <button class="btn" onclick="addTeacher()">Add Teacher</button>
    <table id="teachers-table"><thead><tr><th>Name</th><th>Department</th></tr></thead><tbody></tbody></table>`;
  } else if(section==='units'){
    html=`<h3>Units</h3>
    <input type="text" id="add-unit-name" placeholder="Unit Name">
    <input type="text" id="add-unit-dept" placeholder="Department">
    <button class="btn" onclick="addUnit()">Add Unit</button>
    <table id="units-table"><thead><tr><th>Name</th><th>Department</th></tr></thead><tbody></tbody></table>`;
  } else if(section==='results'){
    html=`<h3>Results</h3>
    <table id="results-table"><thead><tr><th>Student</th><th>Unit</th><th>Exam</th><th>Marks</th></tr></thead><tbody></tbody></table>`;
    renderResults();
  }
  content.innerHTML=html;
  if(section==='students') renderStudentsTable();
  if(section==='teachers') renderTeachersTable();
  if(section==='units') renderUnitsTable();
}

// Admin Functions
function addStudent(){
  let n=document.getElementById('add-student-name').value;
  let d=document.getElementById('add-student-dept').value;
  if(!n || !d){ alert("Fill all fields"); return; }
  users.push({username:n,email:n.toLowerCase()+'@mail.com',role:'Student',department:d});
  renderStudentsTable();
}
function addTeacher(){
  let n=document.getElementById('add-teacher-name').value;
  let d=document.getElementById('add-teacher-dept').value;
  if(!n || !d){ alert("Fill all fields"); return; }
  users.push({username:n,email:n.toLowerCase()+'@mail.com',role:'Teacher',department:d});
  renderTeachersTable();
}
function addUnit(){
  let n=document.getElementById('add-unit-name').value;
  let d=document.getElementById('add-unit-dept').value;
  if(!n || !d){ alert("Fill all fields"); return; }
  units.push({name:n,department:d});
  renderUnitsTable();
}
function renderStudentsTable(){
  const tbody=document.querySelector('#students-table tbody');
  tbody.innerHTML='';
  users.filter(u=>u.role==='Student').forEach(s=>{tbody.innerHTML+=`<tr><td>${s.username}</td><td>${s.department}</td></tr>`;});
}
function renderTeachersTable(){
  const tbody=document.querySelector('#teachers-table tbody');
  tbody.innerHTML='';
  users.filter(u=>u.role==='Teacher').forEach(s=>{tbody.innerHTML+=`<tr><td>${s.username}</td><td>${s.department}</td></tr>`;});
}
function renderUnitsTable(){
  const tbody=document.querySelector('#units-table tbody');
  tbody.innerHTML='';
  units.forEach(u=>{tbody.innerHTML+=`<tr><td>${u.name}</td><td>${u.department}</td></tr>`;});
}
function renderResults(){
  const tbody=document.querySelector('#results-table tbody');
  tbody.innerHTML='';
  examRecords.forEach(e=>{
    const studentExists=users.some(u=>u.username===e.student && u.role==='Student' && u.department);
    if(!studentExists){ alert(`Student ${e.student} or department missing!`); return; }
    tbody.innerHTML+=`<tr><td>${e.student}</td><td>${e.unit}</td><td>${e.exam}</td><td>${e.marks}</td></tr>`;
  });
}

// Teacher Functions
function showAttendanceForm(){
  if(currentUser.role!=="Teacher") return;
  document.getElementById('attendance-section').style.display='block';
  const container=document.getElementById('attendance-form-container');
  container.innerHTML='';
  users.filter(u=>u.role==='Student').forEach(s=>{
    const div=document.createElement('div');
    div.innerHTML=`<label><input type="checkbox" class="att-student" value="${s.username}"> ${s.username} (${s.department})</label>`;
    container.appendChild(div);
  });
}
function markAttendance(){
  const checkboxes=document.querySelectorAll('.att-student');
  const date=new Date().toLocaleDateString();
  checkboxes.forEach(c=>{
    attendanceRecords.push({date:date,student:c.value,status:c.checked?'Present':'Absent',unit:'Unit1'});
    console.log(`Notification sent to parent of ${c.value}: ${c.checked?'Present':'Absent'}`);
  });
  renderAttendanceTable();
}
function renderAttendanceTable(){
  const tbody=document.querySelector('#attendance-table tbody');
  tbody.innerHTML='';
  attendanceRecords.forEach(a=>{
    tbody.innerHTML+=`<tr><td>${a.date}</td><td>${a.unit}</td><td>${a.student}</td><td>${a.status}</td></tr>`;
  });
}
function showExamForm(){
  if(currentUser.role!=="Teacher") return;
  document.getElementById('exam-section').style.display='block';
  const container=document.getElementById('exam-form-container');
  container.innerHTML='';
  users.filter(u=>u.role==='Student').forEach(s=>{
    const div=document.createElement('div');
    div.innerHTML=`<label>${s.username}: <input type="number" class="exam-student" placeholder="Marks out of 100" data-student="${s.username}"></label>`;
    container.appendChild(div);
  });
}
function recordExam(){
  const inputs=document.querySelectorAll('.exam-student');
  inputs.forEach(i=>{
    examRecords.push({student:i.dataset.student,unit:'Unit1',exam:'Midterm',marks:i.value});
  });
  renderExamTable();
}
function renderExamTable(){
  const tbody=document.querySelector('#exam-table tbody');
  tbody.innerHTML='';
  examRecords.forEach(e=>{
    tbody.innerHTML+=`<tr><td>${e.exam}</td><td>${e.unit}</td><td>${e.student}</td><td>${e.marks}</td><td>100</td></tr>`;
  });
}

// --- Particle Animation (before login) ---
const canvas=document.getElementById('particle-canvas');
const ctx=canvas.getContext('2d');
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;
let particles=[];
for(let i=0;i<100;i++){
  particles.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:Math.random()*3+1, dx:(Math.random()-0.5)*2, dy:(Math.random()-0.5)*2});
}
function animate(){
  if(document.body.className==='login-bg'){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    particles.forEach(p=>{
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle='rgba(0,255,255,0.7)';
      ctx.fill();
      p.x+=p.dx; p.y+=p.dy;
      if(p.x>canvas.width||p.x<0)p.dx*=-1;
      if(p.y>canvas.height||p.y<0)p.dy*=-1;
    });
  }
  requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
